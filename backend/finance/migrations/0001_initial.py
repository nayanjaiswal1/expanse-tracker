# Generated by Django 4.2.24 on 2025-11-09 17:17

from decimal import Decimal
from django.conf import settings
import django.core.validators
from django.db import migrations, models
import django.db.models.deletion
import django.utils.timezone


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ("contenttypes", "0002_remove_content_type_name"),
    ]

    operations = [
        migrations.CreateModel(
            name="Account",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("is_deleted", models.BooleanField(default=False)),
                (
                    "name",
                    models.CharField(
                        help_text="Name of the account (e.g., 'Chase Checking', 'Amazon Credit Card')",
                        max_length=255,
                    ),
                ),
                (
                    "description",
                    models.TextField(
                        blank=True,
                        help_text="Optional description or notes about the account",
                    ),
                ),
                (
                    "account_type",
                    models.CharField(
                        choices=[
                            ("checking", "Checking"),
                            ("savings", "Savings"),
                            ("credit", "Credit Card"),
                            ("investment", "Investment"),
                            ("loan", "Loan"),
                            ("cash", "Cash"),
                            ("other", "Other"),
                        ],
                        help_text="Type of the account",
                        max_length=20,
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("active", "Active"),
                            ("inactive", "Inactive"),
                            ("closed", "Closed"),
                            ("frozen", "Frozen"),
                            ("pending", "Pending"),
                        ],
                        default="active",
                        help_text="Current status of the account",
                        max_length=20,
                    ),
                ),
                (
                    "balance",
                    models.DecimalField(
                        decimal_places=2,
                        default=0,
                        help_text="Current balance of the account",
                        max_digits=15,
                    ),
                ),
                (
                    "balance_limit",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Credit limit for credit cards or minimum balance for other accounts",
                        max_digits=15,
                        null=True,
                    ),
                ),
                (
                    "account_number",
                    models.CharField(
                        blank=True,
                        help_text="Last 4 digits of the account number",
                        max_length=100,
                    ),
                ),
                (
                    "last_sync_date",
                    models.DateTimeField(
                        blank=True,
                        help_text="When the account was last synchronized with the bank",
                        null=True,
                    ),
                ),
                (
                    "metadata",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="Additional metadata for the account",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "deleted_at",
                    models.DateTimeField(
                        blank=True,
                        editable=False,
                        help_text="When the account was soft-deleted",
                        null=True,
                    ),
                ),
            ],
            options={
                "ordering": ["name"],
                "abstract": False,
            },
        ),
        migrations.CreateModel(
            name="Budget",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("name", models.CharField(max_length=200)),
                ("start_date", models.DateField()),
                ("end_date", models.DateField()),
                ("total_amount", models.DecimalField(decimal_places=2, max_digits=12)),
                ("is_active", models.BooleanField(default=True)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="budgets",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "ordering": ["-start_date"],
            },
        ),
        migrations.CreateModel(
            name="BudgetTemplate",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("name", models.CharField(max_length=200)),
                (
                    "total_amount",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=12, null=True
                    ),
                ),
                ("is_ai_generated", models.BooleanField(default=False)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="budget_templates",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "ordering": ["-updated_at"],
            },
        ),
        migrations.CreateModel(
            name="Category",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("name", models.CharField(max_length=100)),
                ("icon", models.CharField(blank=True, max_length=50)),
                ("is_active", models.BooleanField(db_index=True, default=True)),
                (
                    "parent",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="children",
                        to="finance.category",
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "verbose_name_plural": "Categories",
                "ordering": ["name"],
            },
        ),
        migrations.CreateModel(
            name="Currency",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "code",
                    models.CharField(
                        help_text="ISO 4217 currency code (e.g., USD, EUR, GBP)",
                        max_length=3,
                        unique=True,
                    ),
                ),
                (
                    "name",
                    models.CharField(
                        help_text="Full name of the currency (e.g., US Dollar, Euro)",
                        max_length=50,
                    ),
                ),
                (
                    "symbol",
                    models.CharField(
                        help_text="Currency symbol (e.g., $, €, £)", max_length=5
                    ),
                ),
                (
                    "symbol_position",
                    models.CharField(
                        choices=[("left", "Left"), ("right", "Right")],
                        default="left",
                        help_text="Position of the currency symbol relative to the amount",
                        max_length=10,
                    ),
                ),
                (
                    "decimal_places",
                    models.PositiveSmallIntegerField(
                        default=2,
                        help_text="Number of decimal places to display",
                        validators=[django.core.validators.MinValueValidator(0)],
                    ),
                ),
                (
                    "decimal_separator",
                    models.CharField(
                        default=".",
                        help_text="Decimal separator (e.g., . or ,)",
                        max_length=1,
                    ),
                ),
                (
                    "thousands_separator",
                    models.CharField(
                        default=",",
                        help_text="Thousands separator (e.g., , or . or space)",
                        max_length=1,
                    ),
                ),
                (
                    "is_active",
                    models.BooleanField(
                        default=True,
                        help_text="Whether this currency is active and can be used",
                    ),
                ),
                (
                    "is_base_currency",
                    models.BooleanField(
                        default=False,
                        help_text="Whether this is the base currency for the system",
                    ),
                ),
                (
                    "exchange_rate",
                    models.DecimalField(
                        decimal_places=6,
                        default=1.0,
                        help_text="Exchange rate to the base currency",
                        max_digits=20,
                    ),
                ),
                (
                    "last_updated",
                    models.DateTimeField(
                        auto_now=True,
                        help_text="When the exchange rate was last updated",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
            ],
            options={
                "verbose_name": "Currency",
                "verbose_name_plural": "Currencies",
                "ordering": ["code"],
            },
        ),
        migrations.CreateModel(
            name="ExpenseGroup",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("name", models.CharField(max_length=255)),
                ("description", models.TextField(blank=True, null=True)),
                (
                    "group_type",
                    models.CharField(
                        choices=[
                            ("one-to-one", "One-to-One"),
                            ("multi-person", "Multi-Person"),
                        ],
                        db_index=True,
                        default="one-to-one",
                        max_length=20,
                    ),
                ),
                ("is_active", models.BooleanField(db_index=True, default=True)),
                ("purpose", models.CharField(blank=True, max_length=255)),
                (
                    "budget_limit",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Maximum spending limit for this group (e.g., trip budget)",
                        max_digits=12,
                        null=True,
                    ),
                ),
                (
                    "budget_warning_threshold",
                    models.DecimalField(
                        decimal_places=2,
                        default=Decimal("80.00"),
                        help_text="Percentage threshold for budget warnings (default 80%)",
                        max_digits=5,
                    ),
                ),
                (
                    "budget_per_person_limit",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Maximum spending per person (optional)",
                        max_digits=12,
                        null=True,
                    ),
                ),
                ("member_history", models.JSONField(blank=True, default=list)),
                (
                    "owner",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="owned_expense_groups",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "verbose_name": "Expense Group",
                "verbose_name_plural": "Expense Groups",
                "ordering": ["-created_at"],
            },
        ),
        migrations.CreateModel(
            name="FinanceAssistantConversation",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("metadata", models.JSONField(blank=True, default=dict)),
                (
                    "assistant_type",
                    models.CharField(
                        choices=[
                            ("quick_add", "Quick Add"),
                            ("invoice_upload", "Invoice Upload"),
                        ],
                        max_length=40,
                    ),
                ),
                ("title", models.CharField(blank=True, max_length=255)),
                ("last_summary", models.TextField(blank=True)),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "ordering": ["-updated_at"],
            },
        ),
        migrations.CreateModel(
            name="Goal",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("name", models.CharField(max_length=255)),
                ("description", models.TextField(blank=True)),
                (
                    "goal_type",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("savings", "Savings Goal"),
                            ("spending", "Spending Goal"),
                            ("debt_payoff", "Debt Payoff"),
                            ("investment", "Investment Goal"),
                        ],
                        max_length=20,
                        null=True,
                    ),
                ),
                ("target_amount", models.DecimalField(decimal_places=2, max_digits=12)),
                (
                    "current_amount",
                    models.DecimalField(decimal_places=2, default=0, max_digits=12),
                ),
                ("target_date", models.DateField(blank=True, null=True)),
                ("start_date", models.DateField(blank=True, null=True)),
                ("currency", models.CharField(default="USD", max_length=3)),
                ("color", models.CharField(blank=True, max_length=7, null=True)),
                (
                    "thumbnail_image",
                    models.URLField(blank=True, max_length=500, null=True),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("active", "Active"),
                            ("completed", "Completed"),
                            ("paused", "Paused"),
                            ("cancelled", "Cancelled"),
                        ],
                        default="active",
                        max_length=20,
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "ordering": ["-created_at"],
            },
        ),
        migrations.CreateModel(
            name="GroupExpense",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("title", models.CharField(max_length=255)),
                ("description", models.TextField(blank=True)),
                ("total_amount", models.DecimalField(decimal_places=2, max_digits=12)),
                ("currency", models.CharField(default="USD", max_length=3)),
                (
                    "split_method",
                    models.CharField(
                        choices=[
                            ("equal", "Split Equally"),
                            ("percentage", "Split by Percentage"),
                            ("amount", "Split by Amount"),
                            ("shares", "Split by Shares"),
                        ],
                        default="equal",
                        max_length=20,
                    ),
                ),
                ("date", models.DateField()),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("active", "Active"),
                            ("settled", "Settled"),
                            ("cancelled", "Cancelled"),
                        ],
                        default="active",
                        max_length=20,
                    ),
                ),
                (
                    "created_by",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="created_expenses",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "group",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="expenses",
                        to="finance.expensegroup",
                    ),
                ),
                (
                    "paid_by",
                    models.ForeignKey(
                        blank=True,
                        help_text="User who paid for this expense",
                        null=True,
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="paid_expenses",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "ordering": ["-date", "-created_at"],
            },
        ),
        migrations.CreateModel(
            name="ParsingAttempt",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "parsing_method",
                    models.CharField(
                        choices=[
                            ("ui_column_extraction", "UI Column Extraction"),
                            ("regex_patterns", "Regex Pattern Matching"),
                            ("ai_parsing", "AI-Powered Parsing"),
                            ("manual_correction", "Manual User Correction"),
                        ],
                        max_length=30,
                    ),
                ),
                ("attempt_order", models.PositiveIntegerField()),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("pending", "Pending"),
                            ("in_progress", "In Progress"),
                            ("success", "Success"),
                            ("failed", "Failed"),
                            ("partial_success", "Partial Success"),
                        ],
                        default="pending",
                        max_length=20,
                    ),
                ),
                ("started_at", models.DateTimeField(auto_now_add=True)),
                ("completed_at", models.DateTimeField(blank=True, null=True)),
                (
                    "duration_seconds",
                    models.DecimalField(
                        blank=True, decimal_places=3, max_digits=8, null=True
                    ),
                ),
                ("transactions_extracted", models.PositiveIntegerField(default=0)),
                (
                    "confidence_score",
                    models.DecimalField(decimal_places=4, default=0.0, max_digits=5),
                ),
                ("error_message", models.TextField(blank=True)),
                ("parsing_config", models.JSONField(blank=True, default=dict)),
                ("raw_extraction_result", models.JSONField(blank=True, default=dict)),
            ],
            options={
                "ordering": ["upload_session", "attempt_order"],
            },
        ),
        migrations.CreateModel(
            name="StatementImport",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("statement_period_start", models.DateField(blank=True, null=True)),
                ("statement_period_end", models.DateField(blank=True, null=True)),
                ("institution_name", models.CharField(blank=True, max_length=255)),
                ("account_number_masked", models.CharField(blank=True, max_length=50)),
                ("raw_text_content", models.TextField(blank=True)),
                ("parsed_data", models.JSONField(blank=True, default=dict)),
                (
                    "metadata",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="Statement level metadata & linked transaction ids",
                    ),
                ),
            ],
            options={
                "ordering": ["statement_period_start"],
            },
        ),
        migrations.CreateModel(
            name="Tag",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("name", models.CharField(max_length=50)),
                ("color", models.CharField(default="#6B7280", max_length=7)),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
        ),
        migrations.CreateModel(
            name="Transaction",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("amount", models.DecimalField(decimal_places=2, max_digits=12)),
                ("description", models.TextField()),
                ("date", models.DateField(db_index=True)),
                ("currency", models.CharField(default="INR", max_length=3)),
                ("notes", models.TextField(blank=True)),
                (
                    "external_id",
                    models.CharField(
                        blank=True, db_index=True, max_length=255, null=True
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("active", "Active"),
                            ("cancelled", "Cancelled"),
                            ("pending", "Pending"),
                            ("failed", "Failed"),
                        ],
                        db_index=True,
                        default="active",
                        max_length=20,
                    ),
                ),
                (
                    "is_credit",
                    models.BooleanField(
                        db_index=True,
                        default=False,
                        help_text="True = Credit (money IN), False = Debit (money OUT)",
                    ),
                ),
                ("is_deleted", models.BooleanField(db_index=True, default=False)),
                ("deleted_at", models.DateTimeField(blank=True, null=True)),
                (
                    "metadata",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="Flexible storage for ALL transaction context:\n        - suggested_category_id: AI-suggested category ID\n        - original_description: Original description before AI processing\n        - transfer_account_id: For transfers (account ID)\n        - transaction_subtype: 'income', 'expense', 'transfer', 'investment', 'lending'\n        - gmail_message_id: Gmail message ID if imported from email\n        - external_source_id: ID from external source (Splitwise, bank, etc.)\n        - supporting_documents: List of file paths/URLs for receipts, invoices\n        - verified: Boolean - manual verification flag\n        - confidence_score: AI categorization confidence (0-100)\n        - source: Import source (gmail, csv, manual, splitwise, etc.)\n        - tags: List of custom tags\n        - location: Transaction location data\n        - custom_fields: Any other custom data\n        ",
                    ),
                ),
                (
                    "account",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="transactions",
                        to="finance.account",
                    ),
                ),
                (
                    "category",
                    models.ForeignKey(
                        blank=True,
                        help_text="Primary transaction category (replaces metadata['category_id'])",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="transactions",
                        to="finance.category",
                    ),
                ),
            ],
            options={
                "verbose_name": "Transaction",
                "verbose_name_plural": "Transactions",
                "ordering": ["-date", "-created_at"],
            },
        ),
        migrations.CreateModel(
            name="UploadSession",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("original_filename", models.CharField(max_length=255)),
                ("file_type", models.CharField(max_length=20)),
                ("file_size", models.BigIntegerField()),
                ("file_hash", models.CharField(blank=True, max_length=64, null=True)),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("pending", "Pending"),
                            ("processing", "Processing"),
                            ("completed", "Completed"),
                            ("failed", "Failed"),
                            ("cancelled", "Cancelled"),
                        ],
                        default="pending",
                        max_length=20,
                    ),
                ),
                ("total_transactions", models.PositiveIntegerField(default=0)),
                ("successful_imports", models.PositiveIntegerField(default=0)),
                ("failed_imports", models.PositiveIntegerField(default=0)),
                ("duplicate_imports", models.PositiveIntegerField(default=0)),
                ("processing_started_at", models.DateTimeField(blank=True, null=True)),
                (
                    "processing_completed_at",
                    models.DateTimeField(blank=True, null=True),
                ),
                ("error_message", models.TextField(blank=True)),
                ("processing_log", models.JSONField(blank=True, default=dict)),
                ("file_content", models.BinaryField(blank=True, null=True)),
                ("requires_password", models.BooleanField(default=False)),
                ("password_attempts", models.PositiveIntegerField(default=0)),
                ("ai_categorization_enabled", models.BooleanField(default=True)),
                (
                    "linked_transactions",
                    models.JSONField(
                        blank=True,
                        default=list,
                        help_text="List of transaction IDs created from this statement",
                    ),
                ),
                (
                    "extracted_tables",
                    models.JSONField(
                        blank=True,
                        default=list,
                        help_text="List of tables extracted from PDF with bounding boxes",
                    ),
                ),
                (
                    "table_extraction_metadata",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="Metadata about table extraction (AI model used, confidence scores, etc.)",
                    ),
                ),
                (
                    "account",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="upload_sessions",
                        to="finance.account",
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "ordering": ["-created_at"],
            },
        ),
        migrations.CreateModel(
            name="TransactionLink",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "link_type",
                    models.CharField(
                        choices=[
                            ("transfer", "Transfer"),
                            ("refund", "Refund"),
                            ("split_payment", "Split Payment"),
                            ("correction", "Correction"),
                            ("duplicate", "Duplicate"),
                        ],
                        max_length=20,
                    ),
                ),
                (
                    "confidence_score",
                    models.DecimalField(decimal_places=4, default=1.0, max_digits=5),
                ),
                ("is_confirmed", models.BooleanField(default=False)),
                ("notes", models.TextField(blank=True)),
                ("auto_detected", models.BooleanField(default=True)),
                (
                    "from_transaction",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="outgoing_links",
                        to="finance.transaction",
                    ),
                ),
                (
                    "to_transaction",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="incoming_links",
                        to="finance.transaction",
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
        ),
        migrations.CreateModel(
            name="TransactionImport",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "import_status",
                    models.CharField(
                        choices=[
                            ("pending", "Pending"),
                            ("imported", "Successfully Imported"),
                            ("duplicate", "Duplicate Detected"),
                            ("failed", "Import Failed"),
                            ("skipped", "Manually Skipped"),
                        ],
                        default="pending",
                        max_length=20,
                    ),
                ),
                ("raw_data", models.JSONField(blank=True, default=dict)),
                (
                    "parsed_amount",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=12, null=True
                    ),
                ),
                ("parsed_date", models.DateField(blank=True, null=True)),
                ("parsed_description", models.TextField(blank=True)),
                ("error_message", models.TextField(blank=True)),
                (
                    "suggested_category_confidence",
                    models.DecimalField(
                        blank=True, decimal_places=4, max_digits=5, null=True
                    ),
                ),
                ("ai_merchant_detection", models.JSONField(blank=True, default=dict)),
                (
                    "statement_import",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="transaction_imports",
                        to="finance.statementimport",
                    ),
                ),
                (
                    "transaction",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="import_records",
                        to="finance.transaction",
                    ),
                ),
                (
                    "upload_session",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="transaction_imports",
                        to="finance.uploadsession",
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "ordering": ["parsed_date", "created_at"],
            },
        ),
        migrations.CreateModel(
            name="TransactionGroup",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("name", models.CharField(db_index=True, max_length=255)),
                (
                    "group_type",
                    models.CharField(
                        choices=[
                            ("merchant", "Merchant"),
                            ("bank", "Bank/Financial Institution"),
                            ("broker", "Investment Broker"),
                            ("person", "Person"),
                            ("expense_group", "Expense Group"),
                            ("employer", "Employer"),
                            ("government", "Government Entity"),
                            ("charity", "Charity/Non-Profit"),
                            ("other", "Other"),
                        ],
                        db_index=True,
                        default="merchant",
                        max_length=20,
                    ),
                ),
                ("description", models.TextField(blank=True)),
                ("is_active", models.BooleanField(db_index=True, default=True)),
                ("total_transactions", models.IntegerField(db_index=True, default=0)),
                (
                    "total_spent",
                    models.DecimalField(
                        decimal_places=2, default=Decimal("0.00"), max_digits=15
                    ),
                ),
                (
                    "total_received",
                    models.DecimalField(
                        decimal_places=2, default=Decimal("0.00"), max_digits=15
                    ),
                ),
                ("last_transaction_date", models.DateField(blank=True, null=True)),
                (
                    "metadata",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="Store type-specific data like website URL, tax ID, contact info, etc.",
                    ),
                ),
                ("logo_url", models.URLField(blank=True, max_length=500)),
                ("color", models.CharField(default="#0066CC", max_length=7)),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "verbose_name": "Transaction Group",
                "verbose_name_plural": "Transaction Groups",
                "ordering": ["-last_transaction_date", "name"],
            },
        ),
        migrations.CreateModel(
            name="TransactionDocument",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "file_path",
                    models.CharField(
                        help_text="Storage path (S3 key or local path)", max_length=500
                    ),
                ),
                (
                    "file_url",
                    models.URLField(
                        help_text="Public URL to access the file", max_length=1000
                    ),
                ),
                ("original_filename", models.CharField(max_length=255)),
                ("file_size", models.IntegerField(help_text="File size in bytes")),
                ("content_type", models.CharField(max_length=100)),
                (
                    "document_type",
                    models.CharField(
                        choices=[
                            ("receipt", "Receipt"),
                            ("invoice", "Invoice"),
                            ("bill", "Bill"),
                            ("statement", "Bank Statement"),
                            ("contract", "Contract"),
                            ("warranty", "Warranty"),
                            ("other", "Other"),
                        ],
                        default="receipt",
                        max_length=20,
                    ),
                ),
                (
                    "processing_status",
                    models.CharField(
                        choices=[
                            ("pending", "Pending"),
                            ("processing", "Processing"),
                            ("completed", "Completed"),
                            ("failed", "Failed"),
                        ],
                        default="pending",
                        max_length=20,
                    ),
                ),
                (
                    "ocr_text",
                    models.TextField(
                        blank=True, help_text="Extracted text from OCR", null=True
                    ),
                ),
                (
                    "extracted_data",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="Structured data extracted from document (merchant, amount, date, items, etc.)",
                    ),
                ),
                (
                    "processing_errors",
                    models.JSONField(
                        blank=True,
                        default=list,
                        help_text="Any errors encountered during processing",
                    ),
                ),
                ("processed_at", models.DateTimeField(blank=True, null=True)),
                (
                    "extraction_confidence",
                    models.FloatField(
                        default=0.0,
                        help_text="Confidence score for extracted data (0-1)",
                    ),
                ),
                (
                    "ai_model_used",
                    models.CharField(
                        blank=True,
                        help_text="AI model used for extraction (e.g., gpt-4, llama3)",
                        max_length=50,
                        null=True,
                    ),
                ),
                (
                    "user_verified",
                    models.BooleanField(
                        default=False,
                        help_text="Whether user has verified the extracted data",
                    ),
                ),
                (
                    "user_corrected_data",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="User corrections to extracted data",
                    ),
                ),
                ("notes", models.TextField(blank=True)),
                (
                    "metadata",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="Additional metadata (upload source, device info, etc.)",
                    ),
                ),
                (
                    "transaction",
                    models.ForeignKey(
                        blank=True,
                        help_text="Transaction this document is attached to (optional for upload before transaction creation)",
                        null=True,
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="documents",
                        to="finance.transaction",
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "verbose_name": "Transaction Document",
                "verbose_name_plural": "Transaction Documents",
                "db_table": "finance_transaction_document",
                "ordering": ["-created_at"],
            },
        ),
        migrations.CreateModel(
            name="TransactionDetail",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "detail_type",
                    models.CharField(
                        choices=[
                            ("line_item", "Line Item"),
                            ("split_share", "Split Share"),
                            ("investment_detail", "Investment Detail"),
                            ("lending_terms", "Lending Terms"),
                            ("installment", "Installment"),
                            ("tax_detail", "Tax Detail"),
                            ("fee", "Fee"),
                            ("discount", "Discount"),
                            ("other", "Other"),
                        ],
                        db_index=True,
                        default="line_item",
                        max_length=20,
                    ),
                ),
                ("name", models.CharField(max_length=255)),
                ("description", models.TextField(blank=True)),
                ("amount", models.DecimalField(decimal_places=2, max_digits=12)),
                (
                    "quantity",
                    models.DecimalField(
                        blank=True,
                        decimal_places=6,
                        help_text="Quantity for line items or investment shares",
                        max_digits=15,
                        null=True,
                    ),
                ),
                (
                    "unit_price",
                    models.DecimalField(
                        blank=True,
                        decimal_places=4,
                        help_text="Price per unit/share",
                        max_digits=12,
                        null=True,
                    ),
                ),
                (
                    "metadata",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="Type-specific data: investment symbols, lending terms, split ratios, etc.",
                    ),
                ),
                ("verified", models.BooleanField(default=False)),
                ("notes", models.TextField(blank=True)),
                (
                    "category",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="transaction_details",
                        to="finance.category",
                    ),
                ),
                (
                    "transaction",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="details",
                        to="finance.transaction",
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "verbose_name": "Transaction Detail",
                "verbose_name_plural": "Transaction Details",
                "ordering": ["transaction", "-amount"],
            },
        ),
        migrations.AddField(
            model_name="transaction",
            name="transaction_group",
            field=models.ForeignKey(
                blank=True,
                help_text="Universal entity: merchant, expense group, bank, person, category, etc.",
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                related_name="transactions",
                to="finance.transactiongroup",
            ),
        ),
        migrations.AddField(
            model_name="transaction",
            name="user",
            field=models.ForeignKey(
                on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL
            ),
        ),
        migrations.CreateModel(
            name="TagAssignment",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("object_id", models.PositiveBigIntegerField()),
                (
                    "content_type",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="finance_tag_assignments",
                        to="contenttypes.contenttype",
                    ),
                ),
                (
                    "tag",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="assignments",
                        to="finance.tag",
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
        ),
        migrations.AddField(
            model_name="statementimport",
            name="upload_session",
            field=models.ForeignKey(
                on_delete=django.db.models.deletion.CASCADE,
                related_name="statement_imports",
                to="finance.uploadsession",
            ),
        ),
        migrations.AddField(
            model_name="statementimport",
            name="user",
            field=models.ForeignKey(
                on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL
            ),
        ),
        migrations.CreateModel(
            name="RegexPattern",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("pattern_name", models.CharField(max_length=100)),
                ("regex_pattern", models.TextField()),
                ("description", models.TextField(blank=True)),
                ("file_type", models.CharField(max_length=20)),
                ("institution_name", models.CharField(blank=True, max_length=255)),
                ("group_mappings", models.JSONField(blank=True, default=dict)),
                ("success_count", models.PositiveIntegerField(default=0)),
                ("failure_count", models.PositiveIntegerField(default=0)),
                (
                    "confidence_score",
                    models.DecimalField(decimal_places=4, default=0.5, max_digits=5),
                ),
                ("is_active", models.BooleanField(default=True)),
                ("is_built_in", models.BooleanField(default=False)),
                ("priority", models.PositiveIntegerField(default=100)),
                ("last_used", models.DateTimeField(blank=True, null=True)),
                (
                    "created_from_parsing_attempt",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="generated_patterns",
                        to="finance.parsingattempt",
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "ordering": ["priority", "confidence_score"],
            },
        ),
        migrations.CreateModel(
            name="ParsingMetrics",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("date", models.DateField()),
                ("ui_extraction_attempts", models.PositiveIntegerField(default=0)),
                ("ui_extraction_successes", models.PositiveIntegerField(default=0)),
                ("regex_attempts", models.PositiveIntegerField(default=0)),
                ("regex_successes", models.PositiveIntegerField(default=0)),
                ("ai_attempts", models.PositiveIntegerField(default=0)),
                ("ai_successes", models.PositiveIntegerField(default=0)),
                ("manual_corrections", models.PositiveIntegerField(default=0)),
                (
                    "avg_confidence_score",
                    models.DecimalField(decimal_places=4, default=0.0, max_digits=5),
                ),
                (
                    "avg_parsing_time",
                    models.DecimalField(decimal_places=3, default=0.0, max_digits=8),
                ),
                ("new_patterns_learned", models.PositiveIntegerField(default=0)),
                ("dataset_entries_added", models.PositiveIntegerField(default=0)),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "ordering": ["-date"],
            },
        ),
        migrations.AddField(
            model_name="parsingattempt",
            name="upload_session",
            field=models.ForeignKey(
                on_delete=django.db.models.deletion.CASCADE,
                related_name="parsing_attempts",
                to="finance.uploadsession",
            ),
        ),
        migrations.AddField(
            model_name="parsingattempt",
            name="user",
            field=models.ForeignKey(
                on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL
            ),
        ),
        migrations.CreateModel(
            name="MerchantPattern",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("pattern", models.CharField(max_length=255)),
                ("merchant_name", models.CharField(blank=True, max_length=255)),
                (
                    "confidence",
                    models.DecimalField(decimal_places=4, default=0.5, max_digits=5),
                ),
                ("usage_count", models.PositiveIntegerField(default=0)),
                ("last_used", models.DateTimeField(blank=True, null=True)),
                ("is_active", models.BooleanField(default=True)),
                ("is_user_confirmed", models.BooleanField(default=False)),
                ("pattern_type", models.CharField(default="contains", max_length=20)),
                ("is_deleted", models.BooleanField(default=False)),
                ("deleted_at", models.DateTimeField(blank=True, null=True)),
                (
                    "category",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="merchant_patterns",
                        to="finance.category",
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
        ),
        migrations.CreateModel(
            name="LearningDataset",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "dataset_type",
                    models.CharField(
                        choices=[
                            ("successful_parsing", "Successful Parsing Example"),
                            ("failed_parsing", "Failed Parsing Example"),
                            ("user_correction", "User Correction"),
                            ("manual_annotation", "Manual Annotation"),
                        ],
                        max_length=30,
                    ),
                ),
                ("raw_text_content", models.TextField()),
                ("file_type", models.CharField(max_length=20)),
                ("institution_name", models.CharField(blank=True, max_length=255)),
                ("expected_transactions", models.JSONField(blank=True, default=list)),
                ("column_mappings", models.JSONField(blank=True, default=dict)),
                ("actual_parsing_result", models.JSONField(blank=True, default=dict)),
                ("is_validated", models.BooleanField(default=False)),
                ("validation_notes", models.TextField(blank=True)),
                (
                    "quality_score",
                    models.DecimalField(
                        blank=True, decimal_places=4, max_digits=5, null=True
                    ),
                ),
                ("is_used_for_training", models.BooleanField(default=False)),
                (
                    "training_weight",
                    models.DecimalField(decimal_places=4, default=1.0, max_digits=5),
                ),
                (
                    "parsing_attempt",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="learning_data",
                        to="finance.parsingattempt",
                    ),
                ),
                (
                    "upload_session",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="learning_data",
                        to="finance.uploadsession",
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "ordering": ["-created_at"],
            },
        ),
        migrations.CreateModel(
            name="InvoiceTrainingDataset",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("version", models.CharField(max_length=50, unique=True)),
                ("name", models.CharField(max_length=200)),
                ("description", models.TextField(blank=True)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("total_samples", models.IntegerField(default=0)),
                ("train_samples", models.IntegerField(default=0)),
                ("validation_samples", models.IntegerField(default=0)),
                ("test_samples", models.IntegerField(default=0)),
                (
                    "avg_field_accuracy",
                    models.DecimalField(decimal_places=2, max_digits=5, null=True),
                ),
                (
                    "avg_line_items_accuracy",
                    models.DecimalField(decimal_places=2, max_digits=5, null=True),
                ),
                ("is_exported", models.BooleanField(default=False)),
                ("export_format", models.CharField(blank=True, max_length=50)),
                ("export_path", models.CharField(blank=True, max_length=500)),
                ("metadata", models.JSONField(blank=True, default=dict)),
                (
                    "created_by",
                    models.ForeignKey(
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "ordering": ["-created_at"],
            },
        ),
        migrations.CreateModel(
            name="InvoiceParsingAttempt",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("file_name", models.CharField(max_length=500)),
                ("file_size", models.IntegerField()),
                ("file_type", models.CharField(max_length=50)),
                ("file_hash", models.CharField(db_index=True, max_length=64)),
                ("raw_ocr_text", models.TextField(blank=True)),
                (
                    "ai_model_used",
                    models.CharField(
                        choices=[
                            ("openai_gpt4", "OpenAI GPT-4"),
                            ("openai_gpt4o", "OpenAI GPT-4o"),
                            ("openai_gpt35", "OpenAI GPT-3.5"),
                            ("anthropic_claude_opus", "Anthropic Claude Opus"),
                            ("anthropic_claude_sonnet", "Anthropic Claude Sonnet"),
                            ("anthropic_claude_haiku", "Anthropic Claude Haiku"),
                            ("ollama_llama3", "Ollama Llama 3"),
                            ("ollama_mistral", "Ollama Mistral"),
                            ("ollama_custom", "Ollama Custom"),
                        ],
                        max_length=50,
                    ),
                ),
                ("ai_provider", models.CharField(max_length=50)),
                ("extraction_method", models.CharField(default="llm", max_length=50)),
                ("processing_time_ms", models.IntegerField(null=True)),
                ("ai_extracted_data", models.JSONField(default=dict)),
                ("user_corrected_data", models.JSONField(blank=True, default=dict)),
                ("final_approved_data", models.JSONField(blank=True, default=dict)),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("pending_review", "Pending Review"),
                            ("user_corrected", "User Corrected"),
                            ("user_approved", "User Approved"),
                            ("failed", "Failed"),
                        ],
                        default="pending_review",
                        max_length=20,
                    ),
                ),
                (
                    "field_accuracy_score",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Percentage of fields correctly extracted",
                        max_digits=5,
                        null=True,
                    ),
                ),
                (
                    "line_items_accuracy_score",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Percentage of line items correctly extracted",
                        max_digits=5,
                        null=True,
                    ),
                ),
                ("is_included_in_training", models.BooleanField(default=False)),
                (
                    "training_dataset_version",
                    models.CharField(blank=True, max_length=50),
                ),
                ("quality_flags", models.JSONField(blank=True, default=dict)),
                ("error_message", models.TextField(blank=True)),
                ("error_type", models.CharField(blank=True, max_length=100)),
                (
                    "transaction",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="invoice_parsing_attempts",
                        to="finance.transaction",
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "ordering": ["-created_at"],
            },
        ),
        migrations.CreateModel(
            name="InvoiceFieldCorrection",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("field_name", models.CharField(max_length=100)),
                (
                    "field_path",
                    models.CharField(
                        help_text="JSON path to the field (e.g., 'line_items[0].description')",
                        max_length=255,
                    ),
                ),
                ("ai_extracted_value", models.TextField(blank=True, null=True)),
                ("user_corrected_value", models.TextField()),
                (
                    "correction_type",
                    models.CharField(
                        choices=[
                            ("wrong_value", "Wrong Value"),
                            ("missing_field", "Missing Field"),
                            ("extra_field", "Extra Field"),
                            ("wrong_format", "Wrong Format"),
                        ],
                        max_length=50,
                    ),
                ),
                (
                    "confidence_score",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="AI's confidence in the original extraction (if available)",
                        max_digits=5,
                        null=True,
                    ),
                ),
                (
                    "parsing_attempt",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="field_corrections",
                        to="finance.invoiceparsingattempt",
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "ordering": ["-created_at"],
            },
        ),
        migrations.CreateModel(
            name="Investment",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("symbol", models.CharField(max_length=20)),
                ("name", models.CharField(max_length=255)),
                (
                    "investment_type",
                    models.CharField(
                        choices=[
                            ("stock", "Stock"),
                            ("bond", "Bond"),
                            ("etf", "ETF"),
                            ("mutual_fund", "Mutual Fund"),
                            ("crypto", "Cryptocurrency"),
                            ("commodity", "Commodity"),
                            ("real_estate", "Real Estate"),
                            ("other", "Other"),
                        ],
                        max_length=20,
                    ),
                ),
                ("sector", models.CharField(blank=True, max_length=100)),
                (
                    "current_price",
                    models.DecimalField(decimal_places=4, default=0, max_digits=12),
                ),
                ("currency", models.CharField(default="USD", max_length=3)),
                ("last_price_update", models.DateTimeField(blank=True, null=True)),
                ("price_source", models.CharField(default="manual", max_length=50)),
                ("auto_update_price", models.BooleanField(default=False)),
                ("portfolio_name", models.CharField(default="Default", max_length=255)),
                (
                    "portfolio_weight",
                    models.DecimalField(decimal_places=2, default=0, max_digits=5),
                ),
                ("description", models.TextField(blank=True)),
                (
                    "risk_level",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("low", "Low Risk"),
                            ("moderate", "Moderate Risk"),
                            ("high", "High Risk"),
                            ("very_high", "Very High Risk"),
                        ],
                        max_length=20,
                        null=True,
                    ),
                ),
                (
                    "dividend_yield",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=5, null=True
                    ),
                ),
                ("market_cap", models.BigIntegerField(blank=True, null=True)),
                (
                    "pe_ratio",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=8, null=True
                    ),
                ),
                (
                    "beta",
                    models.DecimalField(
                        blank=True, decimal_places=3, max_digits=6, null=True
                    ),
                ),
                (
                    "fifty_two_week_high",
                    models.DecimalField(
                        blank=True, decimal_places=4, max_digits=12, null=True
                    ),
                ),
                (
                    "fifty_two_week_low",
                    models.DecimalField(
                        blank=True, decimal_places=4, max_digits=12, null=True
                    ),
                ),
                ("is_active", models.BooleanField(default=True)),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
        ),
        migrations.CreateModel(
            name="GroupExpenseShare",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("share_amount", models.DecimalField(decimal_places=2, max_digits=12)),
                (
                    "paid_amount",
                    models.DecimalField(decimal_places=2, default=0, max_digits=12),
                ),
                ("payment_date", models.DateField(blank=True, null=True)),
                ("notes", models.TextField(blank=True)),
                (
                    "group_expense",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="shares",
                        to="finance.groupexpense",
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="expense_shares",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "ordering": ["-created_at"],
            },
        ),
        migrations.CreateModel(
            name="GoalImage",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("image_url", models.URLField(max_length=500)),
                (
                    "thumbnail_url",
                    models.URLField(blank=True, max_length=500, null=True),
                ),
                ("caption", models.TextField(blank=True)),
                ("is_primary", models.BooleanField(default=False)),
                (
                    "goal",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="images",
                        to="finance.goal",
                    ),
                ),
            ],
            options={
                "ordering": ["-created_at"],
            },
        ),
        migrations.CreateModel(
            name="FinanceAssistantMessage",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "role",
                    models.CharField(
                        choices=[
                            ("user", "User"),
                            ("assistant", "Assistant"),
                            ("system", "System"),
                        ],
                        max_length=20,
                    ),
                ),
                ("content", models.TextField(blank=True)),
                ("payload", models.JSONField(blank=True, default=dict)),
                ("is_error", models.BooleanField(default=False)),
                (
                    "conversation",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="messages",
                        to="finance.financeassistantconversation",
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "ordering": ["created_at"],
            },
        ),
        migrations.CreateModel(
            name="ExpenseGroupMembership",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "role",
                    models.CharField(
                        choices=[("member", "Member"), ("admin", "Admin")],
                        db_index=True,
                        default="member",
                        max_length=20,
                    ),
                ),
                ("is_active", models.BooleanField(db_index=True, default=True)),
                ("joined_at", models.DateTimeField(default=django.utils.timezone.now)),
                ("left_at", models.DateTimeField(blank=True, null=True)),
                (
                    "group",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="memberships",
                        to="finance.expensegroup",
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="expense_group_memberships",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "verbose_name": "Expense Group Membership",
                "verbose_name_plural": "Expense Group Memberships",
                "ordering": ["-created_at"],
            },
        ),
        migrations.AddField(
            model_name="expensegroup",
            name="transaction_group",
            field=models.OneToOneField(
                blank=True,
                help_text="Link to the unified transaction group entity",
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                related_name="expense_group_link",
                to="finance.transactiongroup",
            ),
        ),
        migrations.CreateModel(
            name="ColumnMapping",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("file_type", models.CharField(max_length=20)),
                ("source_column_name", models.CharField(max_length=255)),
                (
                    "source_column_index",
                    models.PositiveIntegerField(blank=True, null=True),
                ),
                (
                    "mapped_field_type",
                    models.CharField(
                        choices=[
                            ("date", "Transaction Date"),
                            ("amount", "Transaction Amount"),
                            ("description", "Description"),
                            ("debit", "Debit Amount"),
                            ("credit", "Credit Amount"),
                            ("balance", "Account Balance"),
                            ("category", "Category"),
                            ("merchant", "Merchant Name"),
                            ("reference", "Reference Number"),
                            ("account_number", "Account Number"),
                        ],
                        max_length=20,
                    ),
                ),
                (
                    "confidence_score",
                    models.DecimalField(decimal_places=4, default=1.0, max_digits=5),
                ),
                ("is_user_confirmed", models.BooleanField(default=False)),
                ("sample_values", models.JSONField(blank=True, default=list)),
                (
                    "parsing_attempt",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="column_mappings",
                        to="finance.parsingattempt",
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
        ),
        migrations.CreateModel(
            name="BudgetTemplateCategory",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "allocated_amount",
                    models.DecimalField(decimal_places=2, max_digits=12),
                ),
                (
                    "category",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        to="finance.category",
                    ),
                ),
                (
                    "template",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="categories",
                        to="finance.budgettemplate",
                    ),
                ),
            ],
        ),
        migrations.CreateModel(
            name="BudgetCategory",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "allocated_amount",
                    models.DecimalField(decimal_places=2, max_digits=12),
                ),
                (
                    "budget",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="categories",
                        to="finance.budget",
                    ),
                ),
                (
                    "category",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        to="finance.category",
                    ),
                ),
            ],
        ),
        migrations.CreateModel(
            name="BalanceRecord",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "balance",
                    models.DecimalField(
                        decimal_places=2,
                        help_text="Account balance at this point",
                        max_digits=12,
                    ),
                ),
                ("date", models.DateField(help_text="Date of the balance record")),
                (
                    "entry_type",
                    models.CharField(
                        choices=[
                            ("daily", "Daily Balance"),
                            ("monthly", "Monthly Statement"),
                            ("weekly", "Weekly Check"),
                            ("manual", "Manual Entry"),
                            ("reconciliation", "Reconciliation"),
                        ],
                        default="manual",
                        max_length=20,
                    ),
                ),
                (
                    "statement_balance",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Official statement balance for comparison",
                        max_digits=12,
                        null=True,
                    ),
                ),
                (
                    "reconciliation_status",
                    models.CharField(
                        choices=[
                            ("pending", "Pending"),
                            ("reconciled", "Reconciled"),
                            ("discrepancy", "Has Discrepancy"),
                            ("investigation", "Under Investigation"),
                        ],
                        default="pending",
                        max_length=20,
                    ),
                ),
                (
                    "difference",
                    models.DecimalField(
                        decimal_places=2,
                        default=0,
                        help_text="Difference between tracked and statement balance",
                        max_digits=12,
                    ),
                ),
                (
                    "total_income",
                    models.DecimalField(
                        decimal_places=2,
                        default=0,
                        help_text="Total income transactions for the period",
                        max_digits=12,
                    ),
                ),
                (
                    "total_expenses",
                    models.DecimalField(
                        decimal_places=2,
                        default=0,
                        help_text="Total expense transactions for the period",
                        max_digits=12,
                    ),
                ),
                (
                    "calculated_change",
                    models.DecimalField(
                        decimal_places=2,
                        default=0,
                        help_text="Calculated balance change based on transactions",
                        max_digits=12,
                    ),
                ),
                (
                    "actual_change",
                    models.DecimalField(
                        decimal_places=2,
                        default=0,
                        help_text="Actual balance change from previous record",
                        max_digits=12,
                    ),
                ),
                (
                    "missing_transactions",
                    models.DecimalField(
                        decimal_places=2,
                        default=0,
                        help_text="Estimated missing transaction amount",
                        max_digits=12,
                    ),
                ),
                (
                    "period_start",
                    models.DateField(
                        blank=True, help_text="Start of the tracking period", null=True
                    ),
                ),
                (
                    "period_end",
                    models.DateField(
                        blank=True, help_text="End of the tracking period", null=True
                    ),
                ),
                (
                    "is_month_end",
                    models.BooleanField(
                        default=False, help_text="Is this a month-end balance"
                    ),
                ),
                (
                    "year",
                    models.IntegerField(
                        blank=True, help_text="Year for easier filtering", null=True
                    ),
                ),
                (
                    "month",
                    models.IntegerField(
                        blank=True, help_text="Month for easier filtering", null=True
                    ),
                ),
                (
                    "notes",
                    models.TextField(
                        blank=True, help_text="Additional notes or observations"
                    ),
                ),
                (
                    "source",
                    models.CharField(
                        blank=True,
                        help_text="Source of the balance (e.g., mobile app, website, manual)",
                        max_length=100,
                    ),
                ),
                (
                    "confidence_score",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Confidence in the balance accuracy (0.00-1.00)",
                        max_digits=3,
                        null=True,
                    ),
                ),
                (
                    "metadata",
                    models.JSONField(
                        blank=True, default=dict, help_text="Additional metadata"
                    ),
                ),
                (
                    "account",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="balance_records",
                        to="finance.account",
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "ordering": ["-date", "account__name"],
            },
        ),
        migrations.CreateModel(
            name="AccountPdfPassword",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "password_encrypted",
                    models.BinaryField(help_text="Encrypted PDF password"),
                ),
                (
                    "label",
                    models.CharField(
                        blank=True,
                        help_text="Optional label for this password (e.g., 'Main password', 'Old password')",
                        max_length=100,
                    ),
                ),
                (
                    "last_used",
                    models.DateTimeField(
                        blank=True,
                        help_text="Last time this password was successfully used",
                        null=True,
                    ),
                ),
                (
                    "usage_count",
                    models.PositiveIntegerField(
                        default=0,
                        help_text="Number of times this password was successfully used",
                    ),
                ),
                (
                    "is_active",
                    models.BooleanField(
                        default=True,
                        help_text="Whether to try this password during upload",
                    ),
                ),
                (
                    "account",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="pdf_passwords",
                        to="finance.account",
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "ordering": ["-usage_count", "-last_used"],
            },
        ),
        migrations.AddField(
            model_name="account",
            name="currency",
            field=models.ForeignKey(
                help_text="Currency used by this account",
                on_delete=django.db.models.deletion.PROTECT,
                related_name="accounts",
                to="finance.currency",
            ),
        ),
        migrations.AddField(
            model_name="account",
            name="user",
            field=models.ForeignKey(
                on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL
            ),
        ),
        migrations.AddIndex(
            model_name="uploadsession",
            index=models.Index(
                fields=["user", "status"], name="finance_upl_user_id_e074b4_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="uploadsession",
            index=models.Index(
                fields=["user", "account"], name="finance_upl_user_id_e1f4da_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="uploadsession",
            index=models.Index(
                fields=["file_hash"], name="finance_upl_file_ha_88e450_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="uploadsession",
            index=models.Index(
                fields=["created_at"], name="finance_upl_created_bb01a4_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="transactionlink",
            index=models.Index(
                fields=["from_transaction"], name="finance_tra_from_tr_d7f3a6_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="transactionlink",
            index=models.Index(
                fields=["to_transaction"], name="finance_tra_to_tran_0e04bf_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="transactionlink",
            index=models.Index(
                fields=["link_type"], name="finance_tra_link_ty_673c48_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="transactionlink",
            index=models.Index(
                fields=["is_confirmed"], name="finance_tra_is_conf_26500c_idx"
            ),
        ),
        migrations.AlterUniqueTogether(
            name="transactionlink",
            unique_together={("from_transaction", "to_transaction", "link_type")},
        ),
        migrations.AddIndex(
            model_name="transactionimport",
            index=models.Index(
                fields=["upload_session", "import_status"],
                name="finance_tra_upload__10ac75_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="transactionimport",
            index=models.Index(
                fields=["transaction"], name="finance_tra_transac_98ab26_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="transactionimport",
            index=models.Index(
                fields=["parsed_date"], name="finance_tra_parsed__962146_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="transactiongroup",
            index=models.Index(
                fields=["user", "group_type", "is_active"],
                name="finance_tra_user_id_4e5e95_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="transactiongroup",
            index=models.Index(
                fields=["user", "is_active", "total_transactions"],
                name="finance_tra_user_id_0680aa_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="transactiongroup",
            index=models.Index(
                fields=["user", "name"], name="finance_tra_user_id_7dd800_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="transactiongroup",
            index=models.Index(
                fields=["user", "last_transaction_date"],
                name="finance_tra_user_id_87d8e8_idx",
            ),
        ),
        migrations.AddConstraint(
            model_name="transactiongroup",
            constraint=models.UniqueConstraint(
                fields=("user", "name", "group_type"),
                name="unique_group_per_user_name_type",
            ),
        ),
        migrations.AddIndex(
            model_name="transactiondocument",
            index=models.Index(
                fields=["user", "transaction"], name="finance_tra_user_id_977e3d_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="transactiondocument",
            index=models.Index(
                fields=["user", "document_type"], name="finance_tra_user_id_99219b_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="transactiondocument",
            index=models.Index(
                fields=["processing_status"], name="finance_tra_process_cbac6e_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="transactiondocument",
            index=models.Index(
                fields=["created_at"], name="finance_tra_created_38f622_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="transactiondetail",
            index=models.Index(
                fields=["transaction", "detail_type"],
                name="finance_tra_transac_1126ba_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="transactiondetail",
            index=models.Index(
                fields=["user", "detail_type"], name="finance_tra_user_id_49c1e7_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="transactiondetail",
            index=models.Index(
                fields=["user", "category"], name="finance_tra_user_id_6676d0_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="transactiondetail",
            index=models.Index(
                fields=["transaction", "category"],
                name="finance_tra_transac_78c9ba_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="transaction",
            index=models.Index(
                fields=["user", "date"], name="finance_tra_user_id_3294c0_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="transaction",
            index=models.Index(
                fields=["user", "status", "date"], name="finance_tra_user_id_237a6e_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="transaction",
            index=models.Index(
                fields=["user", "is_credit", "date"],
                name="finance_tra_user_id_3b2768_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="transaction",
            index=models.Index(
                fields=["user", "account", "date"],
                name="finance_tra_user_id_8ca1ce_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="transaction",
            index=models.Index(
                fields=["user", "transaction_group", "date"],
                name="finance_tra_user_id_7189ce_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="transaction",
            index=models.Index(
                fields=["user", "category", "date"],
                name="finance_tra_user_id_c2bddd_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="transaction",
            index=models.Index(
                fields=["user", "is_deleted", "date"],
                name="finance_tra_user_id_e7da4e_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="transaction",
            index=models.Index(
                fields=["external_id"], name="finance_tra_externa_5e4f43_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="tagassignment",
            index=models.Index(
                fields=["user", "content_type", "object_id"],
                name="finance_tag_user_id_05078f_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="tagassignment",
            index=models.Index(fields=["tag"], name="finance_tag_tag_id_96e206_idx"),
        ),
        migrations.AlterUniqueTogether(
            name="tagassignment",
            unique_together={("user", "tag", "content_type", "object_id")},
        ),
        migrations.AlterUniqueTogether(
            name="tag",
            unique_together={("user", "name")},
        ),
        migrations.AddIndex(
            model_name="regexpattern",
            index=models.Index(
                fields=["file_type", "is_active"], name="finance_reg_file_ty_b3b15e_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="regexpattern",
            index=models.Index(
                fields=["institution_name", "is_active"],
                name="finance_reg_institu_edb13f_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="regexpattern",
            index=models.Index(
                fields=["confidence_score"], name="finance_reg_confide_1e6612_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="regexpattern",
            index=models.Index(
                fields=["priority"], name="finance_reg_priorit_249447_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="parsingmetrics",
            index=models.Index(
                fields=["user", "date"], name="finance_par_user_id_71909b_idx"
            ),
        ),
        migrations.AlterUniqueTogether(
            name="parsingmetrics",
            unique_together={("user", "date")},
        ),
        migrations.AddIndex(
            model_name="parsingattempt",
            index=models.Index(
                fields=["upload_session", "attempt_order"],
                name="finance_par_upload__d80363_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="parsingattempt",
            index=models.Index(
                fields=["parsing_method", "status"],
                name="finance_par_parsing_8520e7_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="parsingattempt",
            index=models.Index(
                fields=["started_at"], name="finance_par_started_25a664_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="merchantpattern",
            index=models.Index(
                fields=["user", "is_active"], name="finance_mer_user_id_d01d3c_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="merchantpattern",
            index=models.Index(
                fields=["category"], name="finance_mer_categor_a78190_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="merchantpattern",
            index=models.Index(
                fields=["confidence"], name="finance_mer_confide_5674d4_idx"
            ),
        ),
        migrations.AlterUniqueTogether(
            name="merchantpattern",
            unique_together={("user", "pattern")},
        ),
        migrations.AddIndex(
            model_name="learningdataset",
            index=models.Index(
                fields=["dataset_type", "is_validated"],
                name="finance_lea_dataset_7c3a28_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="learningdataset",
            index=models.Index(
                fields=["file_type", "institution_name"],
                name="finance_lea_file_ty_70c70e_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="learningdataset",
            index=models.Index(
                fields=["is_used_for_training"], name="finance_lea_is_used_80384a_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="learningdataset",
            index=models.Index(
                fields=["upload_session"], name="finance_lea_upload__d0213c_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="invoiceparsingattempt",
            index=models.Index(
                fields=["user", "status"], name="finance_inv_user_id_362e34_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="invoiceparsingattempt",
            index=models.Index(
                fields=["ai_model_used", "status"],
                name="finance_inv_ai_mode_fddb18_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="invoiceparsingattempt",
            index=models.Index(
                fields=["is_included_in_training"],
                name="finance_inv_is_incl_c42266_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="invoiceparsingattempt",
            index=models.Index(
                fields=["file_hash"], name="finance_inv_file_ha_1e7567_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="invoiceparsingattempt",
            index=models.Index(
                fields=["-created_at"], name="finance_inv_created_6c1ec6_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="invoicefieldcorrection",
            index=models.Index(
                fields=["parsing_attempt", "field_name"],
                name="finance_inv_parsing_bf2d96_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="invoicefieldcorrection",
            index=models.Index(
                fields=["correction_type"], name="finance_inv_correct_744a76_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="investment",
            index=models.Index(
                fields=["user", "is_active"], name="finance_inv_user_id_fa9777_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="investment",
            index=models.Index(
                fields=["symbol", "investment_type"],
                name="finance_inv_symbol_6c19ec_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="investment",
            index=models.Index(
                fields=["portfolio_name"], name="finance_inv_portfol_50d93e_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="investment",
            index=models.Index(fields=["sector"], name="finance_inv_sector_3940a6_idx"),
        ),
        migrations.AlterUniqueTogether(
            name="investment",
            unique_together={("user", "symbol", "investment_type")},
        ),
        migrations.AddIndex(
            model_name="groupexpenseshare",
            index=models.Index(
                fields=["group_expense", "user"], name="finance_gro_group_e_5a682d_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="groupexpenseshare",
            index=models.Index(
                fields=["user", "payment_date"], name="finance_gro_user_id_8b39d7_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="groupexpense",
            index=models.Index(
                fields=["group", "status"], name="finance_gro_group_i_3572ac_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="groupexpense",
            index=models.Index(fields=["date"], name="finance_gro_date_c5d951_idx"),
        ),
        migrations.AddIndex(
            model_name="groupexpense",
            index=models.Index(
                fields=["created_by", "date"], name="finance_gro_created_f71ce5_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="groupexpense",
            index=models.Index(
                fields=["paid_by", "status"], name="finance_gro_paid_by_2da59f_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="goalimage",
            index=models.Index(
                fields=["goal", "is_primary"], name="finance_goa_goal_id_5f8532_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="goal",
            index=models.Index(
                fields=["user", "status"], name="finance_goa_user_id_09c835_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="goal",
            index=models.Index(
                fields=["goal_type"], name="finance_goa_goal_ty_202a71_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="financeassistantmessage",
            index=models.Index(
                fields=["conversation", "created_at"],
                name="finance_fin_convers_868ebf_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="financeassistantconversation",
            index=models.Index(
                fields=["user", "assistant_type"], name="finance_fin_user_id_47e447_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="financeassistantconversation",
            index=models.Index(
                fields=["updated_at"], name="finance_fin_updated_07e814_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="expensegroupmembership",
            index=models.Index(
                fields=["group", "is_active"], name="finance_exp_group_i_8833df_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="expensegroupmembership",
            index=models.Index(
                fields=["user", "is_active"], name="finance_exp_user_id_324a5c_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="expensegroupmembership",
            index=models.Index(
                fields=["role", "is_active"], name="finance_exp_role_ae6b6c_idx"
            ),
        ),
        migrations.AlterUniqueTogether(
            name="expensegroupmembership",
            unique_together={("group", "user")},
        ),
        migrations.AddIndex(
            model_name="expensegroup",
            index=models.Index(
                fields=["owner", "is_active"], name="finance_exp_owner_i_adde49_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="expensegroup",
            index=models.Index(
                fields=["group_type", "is_active"],
                name="finance_exp_group_t_353694_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="columnmapping",
            index=models.Index(
                fields=["parsing_attempt"], name="finance_col_parsing_eb384c_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="columnmapping",
            index=models.Index(
                fields=["file_type", "mapped_field_type"],
                name="finance_col_file_ty_7dda92_idx",
            ),
        ),
        migrations.AlterUniqueTogether(
            name="columnmapping",
            unique_together={("parsing_attempt", "mapped_field_type")},
        ),
        migrations.AddIndex(
            model_name="category",
            index=models.Index(
                fields=["user", "is_active"], name="finance_cat_user_id_bcd8c4_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="category",
            index=models.Index(
                fields=["parent"], name="finance_cat_parent__71eced_idx"
            ),
        ),
        migrations.AlterUniqueTogether(
            name="budgettemplatecategory",
            unique_together={("template", "category")},
        ),
        migrations.AddIndex(
            model_name="budgetcategory",
            index=models.Index(
                fields=["budget", "category"], name="finance_bud_budget__d58f3f_idx"
            ),
        ),
        migrations.AlterUniqueTogether(
            name="budgetcategory",
            unique_together={("budget", "category")},
        ),
        migrations.AddIndex(
            model_name="budget",
            index=models.Index(
                fields=["user", "is_active"], name="finance_bud_user_id_a9d0ec_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="budget",
            index=models.Index(
                fields=["start_date", "end_date"], name="finance_bud_start_d_058f2c_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="balancerecord",
            index=models.Index(
                fields=["user", "date"], name="finance_bal_user_id_5446f4_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="balancerecord",
            index=models.Index(
                fields=["account", "date"], name="finance_bal_account_faee19_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="balancerecord",
            index=models.Index(
                fields=["entry_type", "date"], name="finance_bal_entry_t_9630a2_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="balancerecord",
            index=models.Index(
                fields=["reconciliation_status"], name="finance_bal_reconci_c10f14_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="balancerecord",
            index=models.Index(
                fields=["is_month_end", "date"], name="finance_bal_is_mont_8fd85c_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="balancerecord",
            index=models.Index(
                fields=["year", "month"], name="finance_bal_year_399a26_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="balancerecord",
            index=models.Index(
                fields=["user", "entry_type", "date"],
                name="finance_bal_user_id_d83abe_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="balancerecord",
            index=models.Index(
                fields=["account", "entry_type", "date"],
                name="finance_bal_account_aaad10_idx",
            ),
        ),
        migrations.AlterUniqueTogether(
            name="balancerecord",
            unique_together={("account", "date", "entry_type")},
        ),
        migrations.AddIndex(
            model_name="accountpdfpassword",
            index=models.Index(
                fields=["account", "is_active"], name="finance_acc_account_9d8c8a_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="accountpdfpassword",
            index=models.Index(
                fields=["usage_count"], name="finance_acc_usage_c_ef689c_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="account",
            index=models.Index(fields=["status"], name="finance_acc_status_902c6a_idx"),
        ),
        migrations.AddIndex(
            model_name="account",
            index=models.Index(
                fields=["account_type"], name="finance_acc_account_3b66f3_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="account",
            index=models.Index(
                fields=["is_deleted"], name="finance_acc_is_dele_6e4a76_idx"
            ),
        ),
    ]
